<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="format-detection" content="telephone=no"/>
  <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
  <meta name="viewport"
        content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi"/>
  <link rel="stylesheet" type="text/css" href="index.css"/>
  <title>Beer Challenge</title>
</head>
<body>

<div class="content">
  <h1 class="title">Beer Challenge</h1>
  <img class="logo" src="img/logo.png"/>

  <p id="debug"></p>
  <button class="button">reset</button>
</div>

<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/lodash.min.js"></script>
<script type="text/javascript" src="js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
  document.addEventListener('deviceready', onDeviceReady, false)

  function onDeviceReady() {
    document.querySelector('.content').setAttribute('style', 'display: block;')
    document.querySelector('.button').addEventListener('touchstart', function() {
      this.setAttribute('class', 'button button_active')
      maxPrev = 0
    })
    document.querySelector('.button').addEventListener('touchend', function() {
      this.setAttribute('class', 'button')
    })

    var maxPrev = 0
    var accPrev = undefined
    var start = Date.now()
    var count = 0
    navigator.accelerometer.watchAcceleration(onSuccess, function(e) {
      alert('Accel error', e)
    }, {frequency: 10})

    function onSuccess(acceleration) {
      var acc = [acceleration.x, acceleration.y, acceleration.z]
      count++
      if (accPrev) {
        var change = _.zip(accPrev, acc).map(function(vals) {
          return _.reduce(vals, function(sum, num) {
            return sum - num
          })
        })
        var maxNow = Math.max.apply(Math, _.map(change, Math.abs))
        maxPrev = Math.max(maxNow, maxPrev)
        var secsFromStart = (Date.now() - start) / 1000
        document.getElementById('debug').innerText = 'MAX: ' + maxPrev.toFixed(2) + ' rate: ' + (count / secsFromStart).toFixed(0)
      }
      accPrev = acc
    }
  }
</script>

</body>
</html>
